<!DOCTYPE html>
<html lang="en">

<head>
 <meta charset="utf-8">
 <meta http-equiv="X-UA-Compatible" content="IE=edge">
 <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
 <title>Settings module</title>
 <link rel="stylesheet" href="style.css.gz" />
 <!--		<link href="nodemcu-css.css" rel="stylesheet">-->
 <style>
 </style>
</head>

<body>
 <div id="mySidenav" class="sidenav">
  <span href="javascript:void(0)" class="close" onclick="closeNav()">&times;</span>
  <div class="in"></div>
  <a href="http://web-server.codedevice.ru/example/" target="_blank">Example css</a>
  <a href="https://github.com/bondrogeen/web-server" target="_blank">GitHub</a>
  <a href="http://codedevice.ru" target="_blank">CodeDevice</a>
  <a href="#">About</a>
 </div>
 <div class="sideopen warning"><a onclick="openNav()">&equiv;</a></div>
 <ul class="nav fix warning" id="myTopnav">
  <li><a href="index.html" class="brand active">Web-server</a></li>
  <li><a href="settings.html">Settings</a></li>
  <li><a href="service.html">Service</a></li>
  <li class="-exit"><a href="#" id="btn_exit" onclick="logout()">Exit</a></li>
  <li class="-icon"><a href="#" onclick="nav()">&equiv;</a></li>
 </ul>
 <div class="cont">
  <div class="row">
   <div class="s12 m2 l2">

   </div>
   <div class="s12 m10 l-9 ">
    <h1>Settings</h1>
    <div id="modules" class="row">

    </div>
   </div>
  </div>
 </div>
 <script>
  function send(page, data, callback) {
   var req = new XMLHttpRequest();
   req.open("POST", page, true);
   req.setRequestHeader('Content-Type', 'application/json');
   req.addEventListener("load", function() {
    if (req.status < 400) {
     callback(req.responseText);
    } else {
     callback(false);
    }
   });
   req.send(JSON.stringify(data));
  }

  function text(key, val) {
   var div = document.createElement('div');
   div.className = "s12 m4 l4";
//   div.id = info.name;
   div.innerHTML =
    '<div class="group">' +
    '<input id="' + key + '" type="text" required="" value="' + val + '">'+
   '<label for="' + key + '">' + key + '</label>' +
    '</div>'
   modules.appendChild(div)
  }

  function number(key, val) {
   var div = document.createElement('div');
   div.className = "s12 m4 l4";
//   div.id = info.name;
   div.innerHTML =
    '<div class="group">' +
    '<input id="' + key + '" type="number" required="" value="' + val + '">'+
   '<label for="' + key + '">' + key + '</label>' +
    '</div>'
   modules.appendChild(div)
  }

  function checkbox(key, val) {
   var div = document.createElement('div');
   div.className = "s12 m4 l4";
//   div.id = info.name;
   div.innerHTML =
    '<div class="group">' +
    '<input ' + (val ? "checked " : "") + 'type="checkbox" class="checkbox" id="' + key + '" />' +
    '<label for="' + key + '">' + key + '</label>' +
    '</div>'
   modules.appendChild(div)
  }

  window.onload = function() { //onLoad запустится при загрузке сайта
   var url_string = window.location.href
   var url = new URL(url_string);
   var param = url.searchParams.get("module");
   if (param) {
    var info;
    send(param + ".init", {}, function(res) {
     console.log(res);
     if (res) {
      try {
       info = JSON.parse(res);
      } catch (e) {
       console.log(e);
       return
      }

      for (var key in info) {
       var val = info[key];
       if (typeof(val) === "number") {
number(key, val)
       } else if (typeof(val) === "string") {
text(key, val)
       } else if (typeof(val) === "boolean") {
checkbox(key, val)
       }
       console.log("key : " + key + "  value : " + val);
      }


     }
    });


   }
   console.log(param);
  };




  function logout() {
   document.cookie = "id=";
   location.href = '/login.html';
  }

  function nav() {
   var x = document.getElementById("myTopnav");
   if (x.classList.contains("res")) {
    x.classList.remove('res');
   } else {
    x.classList.add('res');
   }
  }

  function openNav() {
   var side = document.getElementById("mySidenav")
   if (side.style.width === "200px") {
    side.style.width = "0px";
   } else {
    side.style.width = "200px";
   }
  }

  function closeNav() {
   document.getElementById("mySidenav").style.width = "0";
  }
 </script>
</body>

</html>
